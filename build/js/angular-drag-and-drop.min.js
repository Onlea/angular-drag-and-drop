angular.module("onlea.components.dnd",[]);var DragAndDropService;DragAndDropService=function(e){var r,t,n,a,o,i,u,l,d,c,g,s,p,f,v,b,m,D,h,x,C,A,$;return g=[],o=[],i=[],b={},C={current:{draggable:null,droppable:null,event:null},dragging:!1,ready:!1,events:{}},$=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r,t;return r=16*Math.random()|0,t="x"===e?r:3&r|8,t.toString(16)})},p=function(e,r){var t,n;return r.left<(t=e[0])&&t<r.right&&r.top<(n=e[1])&&n<r.bottom},f=function(e,r){return!(r.left>e.right||r.right<e.left||r.top>e.bottom||r.bottom<e.top)},v=function(e,r){if(r)return"ready"===e&&C.ready&&r(),g.push({name:e,cb:r})},A=function(r,t){var n,a,o,i;for(C=c(),e.debug(r,C),"ready"===r&&(C.ready=!0),t&&x(r,t),i=[],a=0,o=g.length;a<o;a++)n=g[a],n.name===r?i.push(n.cb(C)):i.push(void 0);return i},d=function(e){if(C.events.hasOwnProperty(e))return C.events[e]},c=function(){return C},u=function(){return C.current.draggable},l=function(){return C.current.droppable},x=function(e,r){return C.current.event=r,C.events[e]=r},D=function(e){return C.current.draggable=e},h=function(e){return C.current.droppable=e},r=function(e,r){return e.assignTo(r),r.addItem(e),A("item-assigned",d("drag-end"))},m=function(e,r){var t,n,a,o,i;if(r)return e.removeFrom(r),r.removeItem(e),A("item-removed",d("drag-end"));for(o=e.getItems(),i=[],t=0,a=o.length;t<a;t++)n=o[t],i.push(m(e,n));return i},a=function(){var e,r,t,n;for(n=[],r=0,t=i.length;r<t;r++)e=i[r],p(u().midPoint,e.getRect())?e.isActive?n.push(void 0):(h(e),e.activate(),n.push(A("drag-enter",d("drag")))):e.isActive?(h(null),e.deactivate(),n.push(A("drag-leave",d("drag")))):n.push(void 0);return n},n=function(e){return i.push(e)},t=function(e){return o.push(e)},s=function(){return C.dragging},v("drag-start",function(){return C.dragging=!0,C.current.draggable&&m(C.current.draggable),a()}),v("drag",function(){return a()}),v("drag-end",function(){var e,t,n;for(C.dragging=!1,t=0,n=i.length;t<n;t++)e=i[t],e.isActive&&e.deactivate();if(C.current.droppable)return r(C.current.draggable,C.current.droppable)}),{uuid:$,on:v,trigger:A,getState:c,getCurrentDroppable:l,getCurrentDraggable:u,setCurrentDroppable:h,setCurrentDraggable:D,addDroppable:n,addDraggable:t,isDragging:s}},DragAndDropService.$inject=["$log"],angular.module("onlea.components.dnd").factory("DragAndDrop",DragAndDropService);var DraggableController,draggableDirective;DraggableController=function(e,r,t){var n,a,o,i,u,l,d,c;return o=null,c=this,d={rect:{},event:null},a={rect:{},droppables:[],event:null},n=function(){var t;return t=r(angular.element("<div>"+o.html()+"</div>"))(c),t.addClass("clone"),t.addClass(o.attr("class")),e.find("body").append(t)},u=function(e){return e.touches&&1===e.touches.length?[e.touches[0].clientX,e.touches[0].clientY]:[e.clientX,e.clientY]},i=function(e){return e[0].getBoundingClientRect()},l=function(e,r,t){return e.css({transform:"translate("+r+"px, "+t+"px)","-webkit-transform":"translate("+r+"px, "+t+"px)","-ms-transform":"translate("+r+"px, "+t+"px)"})},c.init=function(e,r){if(null==r&&(r={}),console.log("draggable init:",e,r),o=e,a.rect=i(o),r.id?c.id=r.id:c.id=t.uuid(),r.clone)return n()},c.start=function(e){return d.rect=i(o),d.event=e,c.midPoint=[d.rect.left+d.rect.width/2,d.rect.top+d.rect.height/2]},c.move=function(e){var r,t,n,i;return t=u(d.event),r=u(e),n=d.rect.left+(r[0]-t[0]),i=d.rect.top+(r[1]-t[1]),l(o,n,i),a.event=e,a.rect.left=d.rect.left+n,a.rect.right=d.rect.right+n,a.rect.top=d.rect.top+i,a.rect.bottom=d.rect.bottom+i,c.midPoint=[n+d.rect.width/2,i+d.rect.height/2]},c.assignTo=function(e){return a.droppables.push(e),o.addClass("draggable-assigned")},c.removeFrom=function(e){var r,t,n,i,u;for(u=a.droppables,r=n=0,i=u.length;n<i;r=++n)t=u[r],a.droppables.splice(r,1);if(!(a.droppables.length>0))return o.removeClass("draggable-assigned")},c.getItems=function(){return a.droppables},c.isAssigned=function(){return a.droppables.length>0},c.getRect=function(){return a.rect},c},DraggableController.$inject=["$document","$compile","DragAndDrop"],draggableDirective=function(e,r,t,n){var a;return a=function(e,t,a,o){var i,u,l,d,c,g,s;return c="touchstart mousedown",i="touchmove mousemove",s="touchend mouseup",g=function(){var e;return e={},a.clone&&(e.clone=!0),e},d=function(e){return t.removeClass("draggable-active"),n.trigger("drag-end",e),n.setCurrentDraggable(null),r.off(i,u),r.off(s,d)},u=function(e){var r;return o.move(e),n.trigger("drag",e),r=n.getCurrentDroppable(),r?n.trigger("drag-in",e):n.trigger("drag-out",e)},l=function(e){return t.addClass("draggable-active"),o.start(e),n.setCurrentDraggable(o),n.trigger("drag-start",e),r.on(i,u),r.on(s,d)},o.init(t,g()),n.addDraggable(o),t.on(c,l)},{restrict:"A",require:"draggable",controller:DraggableController,controllerAs:"draggable",link:a}},draggableDirective.$inject=["$window","$document","$compile","DragAndDrop"],angular.module("onlea.components.dnd").directive("draggable",draggableDirective);var DroppableController,droppableDirective;DroppableController=function(e,r){var t,n,a;return a=this,n=null,t={rect:{},draggables:[]},a.init=function(t,o){return e.debug("droppable: init",t,o),n=t,a.updateDimensions(),o.id?a.id=o.id:a.id=r.uuid()},a.updateDimensions=function(){return t.rect=n[0].getBoundingClientRect()},a.addItem=function(e){return t.draggables.push(e)},a.removeItem=function(e){var r,n,a,o,i,u;for(i=t.draggables,u=[],r=a=0,o=i.length;a<o;r=++a)n=i[r],n.id===e.id?u.push(t.draggables.splice(r,1)):u.push(void 0);return u},a.activate=function(){return a.isActive=!0,n.addClass("droppable-hovered")},a.deactivate=function(){return a.isActive=!1,n.removeClass("droppable-hovered")},a.getRect=function(){return t.rect},a},DroppableController.$inject=["$log","DragAndDrop"],droppableDirective=function(e,r){var t;return t=function(t,n,a,o){return o.init(n,a),r.addDroppable(o),e.addEventListener("resize",function(e){return o.updateDimensions()})},{restrict:"A",require:"droppable",controller:DroppableController,controllerAs:"droppable",link:t}},droppableDirective.$inject=["$window","DragAndDrop"],angular.module("onlea.components.dnd").directive("droppable",droppableDirective);