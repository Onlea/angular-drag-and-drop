angular.module("onlea.components.dnd",[]);var DragAndDropService;DragAndDropService=function(e){var r,t,n,a,o,i,u,g,l,c,d,s,p,f,v,b,m,D,h,C,A,$;return d=[],o=[],i=[],b={},A={current:{draggable:null,droppable:null,event:null},dragging:!1,ready:!1,events:{}},p=function(e,r){var t,n;return r.left<(t=e[0])&&t<r.right&&r.top<(n=e[1])&&n<r.bottom},f=function(e,r){return!(r.left>e.right||r.right<e.left||r.top>e.bottom||r.bottom<e.top)},v=function(e,r){if(r)return"ready"===e&&A.ready&&r(),d.push({name:e,cb:r})},$=function(r,t){var n,a,o,i;for(A=c(),e.debug(r,A),"ready"===r&&(A.ready=!0),t&&C(r,t),i=[],a=0,o=d.length;a<o;a++)n=d[a],n.name===r?i.push(n.cb(A)):i.push(void 0);return i},l=function(e){if(A.events.hasOwnProperty(e))return A.events[e]},c=function(){return A},u=function(){return A.current.draggable},g=function(){return A.current.droppable},C=function(e,r){return A.current.event=r,A.events[e]=r},D=function(e){return A.current.draggable=e},h=function(e){return A.current.droppable=e},r=function(e,r){return e.assignTo(r),r.addItem(e),$("item-assigned",l("drag-end"))},m=function(e,r){var t,n,a,o,i;if(r)return e.removeFrom(r),r.removeItem(e),$("item-removed",l("drag-end"));for(o=e.getItems(),i=[],t=0,a=o.length;t<a;t++)n=o[t],i.push(m(e,n));return i},a=function(){var e,r,t,n;for(n=[],r=0,t=i.length;r<t;r++)e=i[r],p(u().midPoint,e.getRect())?e.isActive?n.push(void 0):(h(e),e.activate(),n.push($("drag-enter",l("drag")))):e.isActive?(h(null),e.deactivate(),n.push($("drag-leave",l("drag")))):n.push(void 0);return n},n=function(e){return i.push(e)},t=function(e){return o.push(e)},s=function(){return A.dragging},v("drag-start",function(){return A.dragging=!0,A.current.draggable&&m(A.current.draggable),a()}),v("drag",function(){return a()}),v("drag-end",function(){var e,t,n;for(A.dragging=!1,t=0,n=i.length;t<n;t++)e=i[t],e.isActive&&e.deactivate();if(A.current.droppable)return r(A.current.draggable,A.current.droppable)}),{on:v,trigger:$,getState:c,getCurrentDroppable:g,getCurrentDraggable:u,setCurrentDroppable:h,setCurrentDraggable:D,addDroppable:n,addDraggable:t,isDragging:s}},DragAndDropService.$inject=["$log"],angular.module("onlea.components.dnd").factory("DragAndDrop",DragAndDropService);var DraggableController,draggableDirective;DraggableController=function(e){var r,t,n,a,o,i,u;return t=null,u=this,i={rect:{},event:null},r={rect:{},droppables:[],event:null},a=function(e){return e.touches&&1===e.touches.length?[e.touches[0].clientX,e.touches[0].clientY]:[e.clientX,e.clientY]},n=function(e){return e[0].getBoundingClientRect()},o=function(e,r,t){return e.css({transform:"translate("+r+"px, "+t+"px)","-webkit-transform":"translate("+r+"px, "+t+"px)","-ms-transform":"translate("+r+"px, "+t+"px)"})},u.init=function(e,a){return console.log("draggable init:",e,a),t=e,r.rect=n(t)},u.start=function(e){return i.rect=n(t),i.event=e,u.midPoint=[i.rect.left+i.rect.width/2,i.rect.top+i.rect.height/2]},u.move=function(e){var n,g,l,c;return g=a(i.event),n=a(e),l=i.rect.left+(n[0]-g[0]),c=i.rect.top+(n[1]-g[1]),o(t,l,c),r.event=e,r.rect.left=i.rect.left+l,r.rect.right=i.rect.right+l,r.rect.top=i.rect.top+c,r.rect.bottom=i.rect.bottom+c,u.midPoint=[l+i.rect.width/2,c+i.rect.height/2]},u.assignTo=function(e){return r.droppables.push(e),t.addClass("draggable-assigned")},u.removeFrom=function(e){var n,a,o,i,u;for(u=r.droppables,n=o=0,i=u.length;o<i;n=++o)a=u[n],r.droppables.splice(n,1);if(!(r.droppables.length>0))return t.removeClass("draggable-assigned")},u.getItems=function(){return r.droppables},u.isAssigned=function(){return r.droppables.length>0},u.getRect=function(){return r.rect},u},DraggableController.$inject=["DragAndDrop"],draggableDirective=function(e,r,t,n){var a;return a=function(t,a,o,i){var u,g,l,c,d,s;return d="touchstart mousedown",u="touchmove mousemove",s="touchend mouseup",c=function(e){return a.removeClass("draggable-active"),n.trigger("drag-end",e),n.setCurrentDraggable(null),r.off(u,g),r.off(s,c)},g=function(e){var r;return i.move(e),n.trigger("drag",e),r=n.getCurrentDroppable(),r?n.trigger("drag-in",e):n.trigger("drag-out",e)},l=function(e){return a.addClass("draggable-active"),i.start(e),n.setCurrentDraggable(i),n.trigger("drag-start",e),r.on(u,g),r.on(s,c)},i.init(a,t),n.addDraggable(i),a.on(d,l),e.addEventListener("resize",function(e){return i.updateDimensions()})},{restrict:"A",require:"draggable",controller:DraggableController,controllerAs:"draggable",link:a}},draggableDirective.$inject=["$window","$document","$compile","DragAndDrop"],angular.module("onlea.components.dnd").directive("draggable",draggableDirective);var DroppableController,droppableDirective;DroppableController=function(e,r){var t,n,a;return a=this,n=null,t={rect:{},draggables:[]},a.init=function(r,t){return e.debug("droppable: init",r,t),n=r,a.updateDimensions()},a.updateDimensions=function(){return t.rect=n[0].getBoundingClientRect()},a.addItem=function(e){return t.draggables.push(e)},a.removeItem=function(e){var r,n,a,o,i,u;for(i=t.draggables,u=[],r=a=0,o=i.length;a<o;r=++a)n=i[r],n.id===e.id?u.push(t.draggables.splice(r,1)):u.push(void 0);return u},a.activate=function(){return a.isActive=!0,n.addClass("droppable-hovered")},a.deactivate=function(){return a.isActive=!1,n.removeClass("droppable-hovered")},a.getRect=function(){return t.rect},a},DroppableController.$inject=["$log","DragAndDrop"],droppableDirective=function(e,r){var t;return t=function(t,n,a,o){return o.init(n,a),r.addDroppable(o),e.addEventListener("resize",function(e){return o.updateDimensions()})},{restrict:"A",require:"droppable",controller:DroppableController,controllerAs:"droppable",link:t}},droppableDirective.$inject=["$window","DragAndDrop"],angular.module("onlea.components.dnd").directive("droppable",droppableDirective);