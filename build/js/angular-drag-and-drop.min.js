angular.module("onlea.components.dnd",[]);var DragAndDropService;DragAndDropService=function(e){var r,t,n,a,o,i,l,u,d,c,g,s,p,f,v,b,m,x,D,h,C,y,A;return g=[],o=[],i=[],b={},C={current:{draggable:null,droppable:null,event:null},dragging:!1,ready:!1,events:{}},A=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r,t;return r=16*Math.random()|0,t="x"===e?r:3&r|8,t.toString(16)})},p=function(e,r){var t,n;return r.left<(t=e[0])&&t<r.right&&r.top<(n=e[1])&&n<r.bottom},f=function(e,r){return!(r.left>e.right||r.right<e.left||r.top>e.bottom||r.bottom<e.top)},v=function(e,r){if(r)return"ready"===e&&C.ready&&r(),g.push({name:e,cb:r})},y=function(r,t){var n,a,o,i;for(C=c(),e.debug(r,C),"ready"===r&&(C.ready=!0),t&&h(r,t),i=[],a=0,o=g.length;a<o;a++)n=g[a],n.name===r?i.push(n.cb(C)):i.push(void 0);return i},d=function(e){if(C.events.hasOwnProperty(e))return C.events[e]},c=function(){return C},l=function(){return C.current.draggable},u=function(){return C.current.droppable},h=function(e,r){return C.current.event=r,C.events[e]=r},x=function(e){return C.current.draggable=e},D=function(e){return C.current.droppable=e},r=function(e,r){return e.assignTo(r),r.addItem(e),y("item-assigned",d("drag-end"))},m=function(e,r){var t,n,a,o,i;if(r)return e.removeFrom(r),r.removeItem(e),y("item-removed",d("drag-end"));for(o=e.getItems(),i=[],t=0,a=o.length;t<a;t++)n=o[t],i.push(m(e,n));return i},a=function(){var e,r,t,n;for(n=[],r=0,t=i.length;r<t;r++)e=i[r],p(l().midPoint,e.getRect())?e.isActive?n.push(void 0):(D(e),e.activate(),n.push(y("drag-enter",d("drag")))):e.isActive?(D(null),e.deactivate(),n.push(y("drag-leave",d("drag")))):n.push(void 0);return n},n=function(e){return i.push(e)},t=function(e){return o.push(e)},s=function(){return C.dragging},v("drag-start",function(){return C.dragging=!0,C.current.draggable&&m(C.current.draggable),a()}),v("drag",function(){return a()}),v("drag-end",function(){var e,t,n;for(C.dragging=!1,t=0,n=i.length;t<n;t++)e=i[t],e.isActive&&e.deactivate();if(C.current.droppable)return r(C.current.draggable,C.current.droppable)}),{uuid:A,on:v,trigger:y,getState:c,getCurrentDroppable:u,getCurrentDraggable:l,setCurrentDroppable:D,setCurrentDraggable:x,addDroppable:n,addDraggable:t,isDragging:s}},DragAndDropService.$inject=["$log"],angular.module("onlea.components.dnd").factory("DragAndDrop",DragAndDropService);var DraggableController,draggableDirective;DraggableController=function(e,r,t,n){var a,o,i,l,u,d,c,g,s,p,f;return i=null,f=this,p={rect:{},event:null,translate:{x:0,y:0}},o={rect:{},droppables:[],event:null,translate:{x:0,y:0}},c={rect:{}},l=function(e){var r,t,n;return r=document.body.getBoundingClientRect(),t=e[0].getBoundingClientRect(),n={top:t.top-r.top,left:t.left-r.left}},a=function(){var e,n;return e=t(angular.element("<div>"+i.html()+"</div>"))(f),e.addClass("clone"),e.addClass(i.attr("class")),n=l(i),e.css({position:"absolute",top:n.top+"px",left:n.left+"px"}),r.find("body").append(e),i=e},g=function(){},d=function(e){return e.touches&&1===e.touches.length?[e.touches[0].clientX,e.touches[0].clientY]:[e.clientX,e.clientY]},u=function(e){return e[0].getBoundingClientRect()},s=function(e,r,t){return e.css({transform:"translate("+r+"px, "+t+"px)","-webkit-transform":"translate("+r+"px, "+t+"px)","-ms-transform":"translate("+r+"px, "+t+"px)"})},f.init=function(e,r){if(null==r&&(r={}),console.log("draggable init:",e,r,n),i=e,c.rect=u(i),o.rect=u(i),r.id?f.id=r.id:f.id=n.uuid(),r.clone)return a()},f.start=function(e){return p.rect=u(i),p.event=e,p.translate={x:o.translate.x,y:o.translate.y},p.coords=d(p.event),f.midPoint=[c.rect.left+p.translate.x+c.rect.width/2,c.rect.top+p.translate.y+c.rect.height/2]},f.move=function(e){return o.coords=d(e),o.event=e,o.rect=u(i),o.translate.x=p.translate.x+(o.coords[0]-p.coords[0]),o.translate.y=p.translate.y+(o.coords[1]-p.coords[1]),f.midPoint=[c.rect.left+o.translate.x+c.rect.width/2,c.rect.top+o.translate.y+c.rect.height/2],s(i,o.translate.x,o.translate.y)},f.assignTo=function(e){return o.droppables.push(e),i.addClass("draggable-assigned")},f.removeFrom=function(e){var r,t,n,a,l;for(l=o.droppables,r=n=0,a=l.length;n<a;r=++n)t=l[r],o.droppables.splice(r,1);if(!(o.droppables.length>0))return i.removeClass("draggable-assigned")},f.getItems=function(){return o.droppables},f.isAssigned=function(){return o.droppables.length>0},f.getRect=function(){return o.rect},f},DraggableController.$inject=["$log","$document","$compile","DragAndDrop"],draggableDirective=function(e,r,t,n){var a;return a=function(e,t,a,o){var i,l,u,d,c,g,s;return c="touchstart mousedown",i="touchmove mousemove",s="touchend mouseup",g=function(){var e;return e={},a.clone&&(e.clone=!0),e},d=function(e){return t.removeClass("draggable-active"),n.trigger("drag-end",e),n.setCurrentDraggable(null),r.off(i,l),r.off(s,d)},l=function(e){var r;return o.move(e),n.trigger("drag",e),r=n.getCurrentDroppable(),r?n.trigger("drag-in",e):n.trigger("drag-out",e)},u=function(e){return t.addClass("draggable-active"),o.start(e),n.setCurrentDraggable(o),n.trigger("drag-start",e),r.on(i,l),r.on(s,d)},o.init(t,g()),n.addDraggable(o),t.on(c,u)},{restrict:"A",require:"draggable",controller:DraggableController,controllerAs:"draggable",link:a}},draggableDirective.$inject=["$window","$document","$compile","DragAndDrop"],angular.module("onlea.components.dnd").directive("draggable",draggableDirective);var DroppableController,droppableDirective;DroppableController=function(e,r){var t,n,a;return a=this,n=null,t={rect:{},draggables:[]},a.init=function(t,o){return e.debug("droppable: init",t,o),n=t,a.updateDimensions(),o.id?a.id=o.id:a.id=r.uuid()},a.updateDimensions=function(){return t.rect=n[0].getBoundingClientRect()},a.addItem=function(e){return t.draggables.push(e)},a.removeItem=function(e){var r,n,a,o,i,l;for(i=t.draggables,l=[],r=a=0,o=i.length;a<o;r=++a)n=i[r],n.id===e.id?l.push(t.draggables.splice(r,1)):l.push(void 0);return l},a.activate=function(){return a.isActive=!0,n.addClass("droppable-hovered")},a.deactivate=function(){return a.isActive=!1,n.removeClass("droppable-hovered")},a.getRect=function(){return t.rect},a},DroppableController.$inject=["$log","DragAndDrop"],droppableDirective=function(e,r){var t;return t=function(t,n,a,o){return o.init(n,a),r.addDroppable(o),e.addEventListener("resize",function(e){return o.updateDimensions()})},{restrict:"A",require:"droppable",controller:DroppableController,controllerAs:"droppable",link:t}},droppableDirective.$inject=["$window","DragAndDrop"],angular.module("onlea.components.dnd").directive("droppable",droppableDirective);