angular.module("onlea.components.dnd",[]);var DragAndDropController;DragAndDropController=function(e){var t,r,n,o,a,i,s,l,d;return i=function(e,t){var r,n;return t.left<(r=e[0])&&r<t.right&&t.top<(n=e[1])&&n<t.bottom},s=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},t=null,l=!1,a=[],r={},d=this,d.draggables=[],d.droppables=[],d.isDragging=!1,d.currentDraggable=null,d.currentDroppable=null,d.fixedPositions=!1,d.getEvent=function(e){if(r.hasOwnProperty(e))return r},d.getDragAndDropElement=function(){return t},d.getState=function(){var e;return e={draggable:d.getCurrentDraggable(),droppable:d.getCurrentDroppable()}},d.getCurrentDraggable=function(){return d.currentDraggable},d.getCurrentDroppable=function(){return d.currentDroppable},d.isReady=function(){return l},d.setEvent=function(e,t){return r[e]=t,d},d.setDragAndDropElement=function(e){return t=e,d},d.setFixedPositions=function(e){return e?d.fixedPositions=!0:d.fixedPositions=!1,d},d.setCurrentDraggable=function(t){return d.currentDraggable=t,t&&d.fireCallback("drag-start"),e.$evalAsync(function(){return d.currentDraggable=t,t?d.isDragging=!0:d.isDragging=!1}),d},d.setCurrentDroppable=function(e){return d.currentDroppable=e,d},n=function(e){var t,r;return t=e.draggable,r=e.dragEvent,r.touches&&1===r.touches.length?t.updateOffset(r.touches[0].clientX,r.touches[0].clientY):t.updateOffset(r.clientX,r.clientY),d.checkForIntersection()},o=function(e){var t,r;return t=e.draggable,r=e.droppable,t.deactivate(),r&&!r.isFull?d.assignItem(t,r):r&&r.isFull&&scope.enableSwap?d.swapItems(r.items[0],t):(d.unassignItem(draggabl),d.fixedPositions&&t.returnToStartPosition()),r&&r.deactivate(),d.setCurrentDraggable(null)},d.unassignItem=function(e,t){var r,n,o,a,i;for(r=t?[t]:e.dropSpots,a=[],n=0,o=r.length;n<o;n++)i=r[n],e.removeFrom(i),a.push(d.trigger("item-removed",d.getEvent("drag-end")));return a},d.assignItem=function(e,t){return e.assignTo(t),t.itemDropped(e),d.trigger("item-assigned",d.getEvent("drag-end"))},d.swapItems=function(e,t){var r,n,o,a,i,s,l,u,c;for(n=[],l=e.dropSpots,o=0,i=l.length;o<i;o++)c=l[o],n.push(c);for(d.unassignItem(e),e.returnToStartPosition(),u=[],a=0,s=n.length;a<s;a++)r=n[a],u.push(d.assignItem(t,r));return u},d.on=function(e,t){return t&&("ready"===e&&l&&t(),a.push({name:e,cb:t})),d},d.trigger=function(e,t){var r,n,o,i,s;for(s=d.getState(),"ready"===e&&(l=!0),t&&(d.setEvent(name,t),s.dragEvent=t),i=[],n=0,o=a.length;n<o;n++)r=a[n],r.name===e?i.push(r.cb(s)):i.push(void 0);return i},d.checkForIntersection=function(){var e,t,r,n;for(n=d.droppables,t=0,r=n.length;t<r;t++)e=n[t],i(d.currentDraggable.midPoint,e)?e.isActive||(d.setCurrentDroppable(e),e.activate(),d.trigger("drag-enter",d.getEvent("drag"))):e.isActive&&(this.setCurrentDroppable(null),e.deactivate(),d.trigger("drag-leave",d.getEvent("drag")));return d},d.addDroppable=function(e){return d.droppables.push(e),d},d.addDraggable=function(e){return d.draggables.push(e),d},d.addClone=function(e){return this.getDragAndDropElement().append(e)},d},DragAndDropController.$inject=["$scope"],angular.module("onlea.components.dnd").controller("DragAndDropController",DragAndDropController);var dragAndDropDirective;dragAndDropDirective=function(e){var t;return t=function(t,r,n,o){var a,i,s,l;return a="touchmove mousemove",l="touchend mouseup",o.setDragAndDropElement(r),o.setFixedPositions(t.fixedPositions),e.on(a,i),e.on(l,s),o.on("drag-start",function(){return $scope.onDragStart}),o.on("drag-end",function(){return $scope.onDragEnd}),o.on("drag",t.onDrag),o.on("item-assigned",t.onItemPlaced),o.on("item-removed",t.onItemRemoved),o.on("drag-leave",t.onDragLeave),o.on("drag-enter",t.onDragEnter),o.on("drag-start",function(){return r.addClass("dragging")}),o.on("drag-end",function(){return r.removeClass("dragging"),r.addClass("drag-return"),setTimeout(function(){return r.removeClass("drag-return")},500)}),s=function(e){if(o.getCurrentDraggable())return o.trigger("drag-end",e)},i=function(e){if(o.getCurrentDraggable())return o.trigger("drag",e)},t.$on("$destroy",function(){return e.off(a,i),e.off(l,s)}),o.trigger("ready")},{restrict:"AE",scope:{onItemPlaced:"&",onItemRemoved:"&",onDrag:"&",onDragStart:"&",onDragEnd:"&",onDragEnter:"&",onDragLeave:"&",enableSwap:"=",fixedPositions:"="},require:"dragAndDrop",controller:DragAndDropController,controllerAs:"dnd",link:t}},dragAndDropDirective.$inject=["$document"],angular.module("onlea.components.dnd").directive("dragAndDrop",dragAndDropDirective);var DragItemController,dragItemDirective;DragItemController=function(){var e,t,r,n,o,a;return e=null,n={locked:{horizontal:!1,vertical:!1}},t=null,r=[0,0],o=null,a=this,a.dropSpots=[],a.isAssigned=!1,a.setDragId=function(){},a.setDragData=function(){},a.setStartPosition=function(e,t){return r=[e,t]},a.setDragItemElement=function(e){return e=o=e,t=e[0].getBoundingClientRect(),a},a.setTransformElement=function(e){return o=e},a.setDimensions=function(){return a.top=a.y+t.top,a.left=a.x+t.left,a.bottom=a.top+t.height,a.right=a.left+t.width,a.midPoint=[(a.left+a.right)/2,(a.top+a.bottom)/2],a.isVerticallyLocked()&&(a.percent=100*a.midPoint[0]/e.parent()[0].clientWidth,a.percent=Math.min(100,Math.max(0,scope.percent))),a},a.lockAxis=function(e){return a.state.locked.horizontal=!0,a.state.locked.vertical=!0,a},a.unlockAxis=function(e){return a.state.locked.horizontal=!1,a.state.locked.vertical=!1,a},a.isVerticallyLocked=function(){return a.state.locked.vertical},a.isHorizontallyLocked=function(){return a.state.locked.horizontal},a.setPercentPostion=function(t,r){var n,o;return o=e.parent()[0].clientHeight*(r/100)-e[0].clientHeight/2,n=e.parent()[0].clientWidth*(t/100)-e[0].clientWidth/2,a.setPosition(n,o),a},a.setPosition=function(e,t){return a.x=a.isHorizontallyLocked()?0:e,a.y=a.isVerticallyLocked()?0:t,a.setDimensions(),o.css({transform:"translate("+a.x+"px, "+a.y+"px)","-webkit-transform":"translate("+a.x+"px, "+a.y+"px)","-ms-transform":"translate("+a.x+"px, "+a.y+"px)"}),a},a.updateOffset=function(t,r){return a.setPosition(t-(eventOffset[0]+e[0].offsetLeft),r-(eventOffset[1]+e[0].offsetTop)),a},a.returnToStartPosition=function(){return scope.setPosition(r[0],r[1])},a.assignTo=function(t){if(t&&(a.dropSpots.push(t),a.isAssigned=!0,t.dropId))return e.addClass("in-"+t.dropId)},a.removeFrom=function(t){var r;if(r=scope.dropSpots.indexOf(t),r>-1)return t.dropId&&e.removeClass("in-"+t.dropId),scope.dropSpots.splice(r,1),scope.dropSpots.length<1&&(scope.isAssigned=!1),t.removeItem(scope)},a.removeFromAll=function(){var e,t,r,n,o;for(r=scope.dropSpots,n=[],e=0,t=r.length;e<t;e++)o=r[e],n.push(scope.removeFrom(o));return n},a.addClass=e.addClass,a.removeClass=e.removeClass,a.toggleClass=e.toggleClass,a.activate=function(){return e.addClass("drag-active"),a.isDragging=!0},a.deactivate=function(){var t;return t=[0,0],a.clone&&cloneEl.removeClass("clone-active"),e.removeClass("drag-active"),a.isDragging=!1},a},dragItemDirective=function(e,t,r){return{restrict:"EA",require:["^dragAndDrop","dragItem"],controller:DragItemController,controllerAs:"drag",scope:{x:"@",y:"@",dropTo:"@",dragId:"@",dragEnabled:"=",dragData:"=",clone:"=",lockHorizontal:"=",lockVertical:"="},link:function(t,n,o,a){var i,s,l,d,u,c;return d=function(e){if(t.dragEnabled)return s.setCurrentDraggable(l),s.trigger("drag-start",e)},i=function(){var e;return e=r(angular.element("<div>"+n.html()+"</div>"))(t),e.addClass("clone"),e.addClass(n.attr("class")),e},s=a[0],l=a[1],u="touchstart mousedown",l.setStartPosition(t.x,t.y),s.addDraggable(l),l.setDragId(t.dragId),l.setDragData(t.dragData),n.on(u,d),e.addEventListener("resize",l.setDimensions),t.clone&&(c=i(),s.addClone(c),l.setTransformElement(c)),l.returnToStartPosition(),t.$on("$destroy",function(){return n.off(u,d),e.removeEventListener("resize",l.setDimensions)}),s.on("ready",init)}}},dragItemDirective.$inject("$window","$document","$compile"),angular.module("onlea.components.dnd").directive("dragItem",dragItemDirective);var dropSpotDirective;dropSpotDirective=["$window",function(e){return{restrict:"AE",require:"^dragAndDrop",transclude:!0,template:"<div class='drop-content' ng-class='{ \"drop-full\": isFull }' ng-transclude></div>",scope:{dropId:"@",maxItems:"="},link:function(t,r,n,o){var a,i,s,l,d,u,c;return u=function(){return t.left=r[0].offsetLeft,t.top=r[0].offsetTop,t.right=t.left+r[0].offsetWidth,t.bottom=t.top+r[0].offsetHeight},s=function(e){var r,n,o,a;switch(r=[t.right-t.left,t.bottom-t.top],n=[e.right-e.left,e.bottom-e.top],e.dropTo){case"top":o=t.left+(r[0]-n[0])/2,a=t.top;break;case"bottom":o=t.left+(r[0]-n[0])/2,a=t.top+(r[1]-n[1]);break;case"left":o=t.left,a=t.top+(r[1]-n[1])/2;break;case"right":o=t.left+(r[0]-n[0]),a=t.top+(r[1]-n[1])/2;break;case"top left":o=t.left,a=t.top;break;case"bottom right":o=t.left+(r[0]-n[0]),a=t.top+(r[1]-n[1]);break;case"bottom left":o=t.left,a=t.top+(r[1]-n[1]);break;case"top right":o=t.left+(r[0]-n[0]),a=t.top;break;case"center":o=t.left+(r[0]-n[0])/2,a=t.top+(r[1]-n[1])/2;break;default:e.dropOffset&&(o=t.left+e.dropOffset[0],a=t.top+e.dropOffset[1])}return[o,a]},t.itemDropped=function(e){var r,n;return r=a(e),r?e.dropTo?(n=s(e),e.updateOffset(n[0],n[1])):e.dropOffset=[e.left-t.left,e.top-t.top]:t.fixedPositions?e.returnToStartPosition():void 0},a=function(e){return!t.isFull&&(t.items.push(e),t.items.length>=t.maxItems&&(t.isFull=!0),e)},t.removeItem=function(e){var r;if(r=t.items.indexOf(e),r>-1&&(t.items.splice(r,1),t.items.length<t.maxItems))return t.isFull=!1},t.activate=function(){return t.isActive=!0,r.addClass("drop-hovering")},t.deactivate=function(){return t.isActive=!1,o.setCurrentDroppable(null),r.removeClass("drop-hovering")},l=function(){var e,r,n,o,a,i;for(u(),a=t.items,i=[],e=0,n=a.length;e<n;e++)r=a[e],o=s(r),i.push(r.updateOffset(o[0],o[1]));return i},i=function(){return c.bind("resize",l)},d=function(){return c.unbind("resize",l)},t.dropId&&r.addClass(t.dropId),c=angular.element(e),i(),t.$on("$destroy",function(){return d()}),u(),t.isActive=!1,t.items=[],o.addDroppable(t)}}}];